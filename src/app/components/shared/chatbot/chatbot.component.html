<!-- Floating Chat Toggle Button -->
<button
  class="chat-toggle-btn btn btn-primary rounded-circle shadow animate__animated animate__fadeInUp"
  (click)="toggleChat()"
  title="Ask Chatbot"
  style="
    position: fixed;
    bottom: 20px;
    right: 20px;
    z-index: 1050;
    width: 60px;
    height: 60px;
    transition: all 0.3s ease-in-out;
  "
>
  <i class="bi fs-4" [ngClass]="isOpen ? 'bi-x-lg' : 'bi-chat-dots-fill'"></i>
</button>

<!-- Chat Window -->
<div
  class="chat-window card animate__animated animate__fadeInUp"
  *ngIf="isOpen"
  style="
    position: fixed;
    bottom: 90px;
    right: 20px;
    width: 360px;
    z-index: 1050;
    box-shadow: 0 8px 16px rgba(0, 0, 0, 0.2);
    border-radius: 16px;
  "
>
  <!-- Header -->
  <div
    class="card-header bg-primary text-white d-flex justify-content-between align-items-center rounded-top"
  >
    <span>
      <i class="bi bi-robot me-2 text-warning"></i>
      Ask Assistant
    </span>
    <i
      class="bi bi-x-lg cursor-pointer"
      role="button"
      (click)="toggleChat()"
    ></i>
  </div>

  <!-- Messages Area -->
  <div
    class="card-body chat-messages"
    style="
      max-height: 400px;
      overflow-y: auto;
      background: #f8f9fa;
      padding: 12px;
    "
  >
    <div
      *ngFor="let msg of messages"
      class="d-flex mb-2 fade-in"
      [ngClass]="{ 'justify-content-end': msg.from === 'user' }"
    >
      <div
        class="p-2 rounded animate__animated animate__fadeInUp"
        [ngClass]="{
          'bg-primary text-white': msg.from === 'user',
          'bg-light text-dark': msg.from === 'bot'
        }"
        style="max-width: 80%; font-size: 0.95rem"
      >
        <i *ngIf="msg.from === 'bot'" class="bi bi-robot me-1 text-warning"></i>
        <i
          *ngIf="msg.from === 'user'"
          class="bi bi-person-circle me-1 text-light"
        ></i>
        {{ msg.text }}
      </div>
    </div>

    <!-- Loading Spinner -->
    <div *ngIf="loading" class="text-center text-muted small mt-2">
      <i class="bi bi-arrow-repeat spin"></i> Thinking...
    </div>
  </div>

  <!-- Suggested Questions -->
  <div class="mt-3">
    <small class="text-muted mb-1 d-block">Suggested Questions:</small>
    <div class="d-flex flex-wrap gap-2">
      <button
        class="btn btn-outline-secondary btn-sm"
        *ngFor="let q of suggestedQuestions"
        (click)="sendSuggested(q)"
      >
        <i class="bi bi-question-circle me-1"></i>{{ q.question }}
      </button>
    </div>
  </div>

  <!-- Input -->
  <div class="card-footer d-flex align-items-center">
    <input
      type="text"
      class="form-control me-2"
      [formControl]="questionControl"
      (keyup.enter)="sendMessage()"
      placeholder="Ask something..."
    />
    <button class="btn btn-primary" (click)="sendMessage()">
      <i class="bi bi-send-fill"></i>
    </button>
  </div>
</div>
