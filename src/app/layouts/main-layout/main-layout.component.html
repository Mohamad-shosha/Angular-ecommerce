<div class="page-wrapper">
  <!-- MENU SIDEBAR-->

  <!-- END ASIDE / SIDEBAR -->
  <!-- END MENU SIDEBAR-->

  <div class="page-container">
    <!-- HEADER DESKTOP-->
    <header class="header-desktop animate__animated animate__fadeInDown">
      <div class="section-content section-content-p30">
        <div class="container-fluid">
          <div class="header-wrap">
            <!-- Search Component (Now contains the input and button directly) -->
            <div
              class="search-container me-auto animate__animated animate__fadeInLeft animate__delay-0-3s"
            >
              <app-search></app-search>
            </div>

            <div class="logo-wrapper">
              <a routerLink="/products" class="logo-link">
                <img
                  src="assets/images/logo.png"
                  alt="drova"
                  class="img-fluid logo-img"
                />
              </a>
            </div>

            <!-- Login/Register/User Info & Cart Status -->
            <div class="header-right-actions d-flex align-items-center">
              <!-- Login/Register/User Info -->
              <div
                class="user-auth-wrapper me-3 animate__animated animate__fadeInRight animate__delay-0-3s"
              >
                <ng-container *ngIf="!userEmail; else loggedIn">
                  <button
                    class="btn btn-login btn-sm me-2"
                    [disabled]="isLoginLoading"
                    (click)="goToLogin()"
                  >
                    <span *ngIf="!isLoginLoading">
                      <i class="bi bi-box-arrow-in-right me-1"></i>Login
                    </span>
                    <div
                      *ngIf="isLoginLoading"
                      class="spinner-border spinner-border-sm"
                      role="status"
                    ></div>
                  </button>
                  <button
                    class="btn btn-register btn-sm"
                    [disabled]="isRegisterLoading"
                    (click)="goToRegister()"
                  >
                    <span *ngIf="!isRegisterLoading">
                      <i class="bi bi-person-plus-fill me-1"></i>Register
                    </span>
                    <div
                      *ngIf="isRegisterLoading"
                      class="spinner-border spinner-border-sm"
                      role="status"
                    ></div>
                  </button>
                </ng-container>

                <ng-template #loggedIn>
                  <div
                    class="user-info-display d-flex align-items-center gap-2"
                  >
                    <i class="bi bi-person-circle user-icon"></i>
                    <span class="user-email-text">{{ userEmail }}</span>
                    <button
                      class="btn btn-logout btn-sm ms-2"
                      [disabled]="islogoutLoading"
                      (click)="logout()"
                    >
                      <span *ngIf="!islogoutLoading">
                        <i class="bi bi-box-arrow-right me-1"></i>Logout
                      </span>
                      <div
                        *ngIf="islogoutLoading"
                        class="spinner-border spinner-border-sm"
                        role="status"
                      ></div>
                    </button>
                  </div>
                </ng-template>
              </div>

              <!-- Cart Status Component -->
              <div
                class="cart-status-container animate__animated animate__fadeInRight animate__delay-0-5s"
              >
                <app-cart-status></app-cart-status>
              </div>
            </div>
            <!-- /header-right-actions -->
          </div>
          <!-- /header-wrap -->
          <div class="account-wrap"></div>
          <!-- Keep if needed for other layouts -->
        </div>
        <!-- /container-fluid -->
      </div>
      <!-- /section-content -->
    </header>
    <!-- END HEADER DESKTOP-->
    <div class="w-100 mt-2">
      <app-product-category-menu></app-product-category-menu>
    </div>

    <!-- MAIN CONTENT-->
    <router-outlet></router-outlet>
    <!-- Floating Button -->
    <button
      class="btn btn-warning insight-btn position-fixed rounded-circle shadow animate__animated animate__infinite animate__pulse"
      style="bottom: 20px; right: 20px; z-index: 999"
      data-bs-toggle="modal"
      data-bs-target="#insightsModal"
      title="View Product Statistics"
    >
      <i class="bi bi-bar-chart-fill fs-5"></i>
    </button>

    <!-- Modal -->
    <div
      class="modal fade"
      id="insightsModal"
      tabindex="-1"
      aria-labelledby="insightsModalLabel"
      aria-hidden="true"
    >
      <div class="modal-dialog modal-xl modal-dialog-centered">
        <div class="modal-content">
          <div class="modal-header">
            <h5 class="modal-title" id="insightsModalLabel">
              Products & Colors Analytics
            </h5>
            <button
              type="button"
              class="btn-close"
              data-bs-dismiss="modal"
              aria-label="Close"
            ></button>
          </div>
          <div class="modal-body text-center">
            <iframe
              title="graduation_website"
              width="100%"
              height="500"
              src="https://app.powerbi.com/view?r=eyJrIjoiMTU0MTU1MjYtYTU5Yi00NGMyLWJkYWUtZTUyMmE1ZGRkYTMyIiwidCI6Ijc0MjY4YzVhLWU1MjItNDY2YS1iMDg4LWQ0NDQ3MzNiNjJjOCJ9"
              frameborder="0"
              allowFullScreen="true"
            ></iframe>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>

<!-- ENDS PAGE CONTAINER -->

<!-- âœ… Footer -->
<footer class="footer mt-auto py-4 bg-dark text-white-50">
  <div
    class="container d-flex flex-column flex-md-row justify-content-between align-items-center"
  >
    <div class="mb-2 mb-md-0 text-center text-md-start">
      &copy; {{ currentYear }} Team Ecommerce. All rights reserved.
    </div>

    <ul class="list-unstyled d-flex gap-4 mb-0 justify-content-center">
      <li><a class="footer-link">Terms</a></li>
      <li><a class="footer-link">Privacy</a></li>
      <li><a class="footer-link">Help</a></li>
      <li><a class="footer-link">Shop</a></li>
    </ul>
  </div>
</footer>
